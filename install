#!/bin/bash
# vim: set ts=4 sw=4 sts=0 et ft=sh fenc=utf-8 ff=unix :

commonFiles=".systeminfo .screenrc .vimrc .tmux.conf"
bashFiles=".bash_profile .bashrc .bash_aliases .bash_logout .inputrc"
zshFiles=".zshrc .zsh_aliases .zshrc.d"

function get-git-completion(){
    local loginshell
    loginshell="$1"
    if [ ! -f "${HOME}/.git-completion.${loginshell}" ]; then
        curl -s --output "${HOME}/.git-completion.${loginshell}" \
            "https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.${loginshell}"
        chmod 644 "${HOME}/.git-completion.${loginshell}"
    fi
}

shellType="$1"
if [ -z "$shellType" ]; then shellType="$( basename "$SHELL" 2> /dev/null )" ; fi
cd "$( dirname "$0" )" || exit 1
PATH_TO_CONF="$PWD"

case "${shellType:-unknown}" in
    bash )
        rcFiles="$commonFiles $bashFiles"
        get-git-completion bash
        ;;
    zsh )
        rcFiles="$commonFiles $zshFiles"
        get-git-completion zsh
        ;;
    * )
        echo "Unknown shell: $shellType"
        echo "type $0 bash|zsh"
        exit 0
        ;;
esac

for i in $rcFiles
do
    if [ -e "${PATH_TO_CONF}/dot$i" ]; then
        ln -fs "${PATH_TO_CONF}/dot$i" "$HOME/$i"
    fi
done

if [ -x /usr/bin/lesskey ]; then
    if [ -f "${PATH_TO_CONF}/dot.lesskey" ]; then
        ln -fs "${PATH_TO_CONF}/dot.lesskey" "$HOME/.lesskey"
        /usr/bin/lesskey
    fi
fi
